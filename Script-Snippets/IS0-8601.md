# Adding ISO-8601 Timestamps to Logfile Events

Every event in LogScale requires a timestamp.  Here are some snippets to add an ISO 8601 timestamp to log enteries.

## Bash

```bash
#!/bin/bash
set -e

exec > >(tee -a /var/log/output.log) 2>&1

LOG_SEQUENCE=0
log_event() {
  LOG_SEQUENCE=$((LOG_SEQUENCE + 1))
  SEQ_NUM=$(printf "%04d" $LOG_SEQUENCE)
  echo "$(date -u '+%Y-%m-%dT%H:%M:%SZ') [$SEQ_NUM] $1"
}

# Example usage
log_event "Starting main configuration script"
```

`exec` runs the script in the existing shell process instead of spawning a new shell.

Using `tee` means that the function can be used with both interactive and non-interactive sessions

Use the `log_event` function instead of `echo`.

## Powershell

Here's a similar function written in Powershell.

```pwsh
# Enable strict mode and stop on error
$ErrorActionPreference = "Stop"

# Define log file path
$LogFile = "C:\ProgramData\config.log"

# Create log directory if it doesn't exist
$logDir = [System.IO.Path]::GetDirectoryName($LogFile)
if (-not (Test-Path $logDir)) {
    New-Item -ItemType Directory -Path $logDir -Force | Out-Null
}

# Initialize global log sequence counter
$global:LogSequence = 0

function Log-Event {
    param (
        [string]$Message
    )

    $global:LogSequence++
    $seq = $global:LogSequence.ToString("D4")  # Format with leading zeros
    $timestamp = (Get-Date).ToUniversalTime().ToString("yyyy-MM-ddTHH:mm:ssZ")
    $entry = "$timestamp [$seq] $Message"

    # Output to console
    Write-Host $entry

    # Append to log file
    Add-Content -Path $LogFile -Value $entry

# Example usage
Log-Event "Starting main configuration script"
}
```

## Python

```python
#!/usr/bin/env python3
import logging
import sys
from datetime import datetime

# Log file path
LOG_FILE = "/var/log/config.log"

# Configure logger
logger = logging.getLogger("__name__")
# logger = logging.getLogger("DesiredLogName")
logger.setLevel(logging.INFO)

# Custom formatter with UTC timestamp and sequence number
class SequenceFormatter(logging.Formatter):
    def __init__(self):
        super().__init__()
        self.sequence = 0

    def format(self, record):
        self.sequence += 1
        timestamp = datetime.utcnow().strftime("%Y-%m-%dT%H:%M:%SZ")
        seq_str = f"{self.sequence:04d}"
        return f"{timestamp} [{seq_str}] {record.getMessage()}"

formatter = SequenceFormatter()

# Stream handler (console)
console_handler = logging.StreamHandler(sys.stdout)
console_handler.setFormatter(formatter)
logger.addHandler(console_handler)

# File handler (append mode)
file_handler = logging.FileHandler(LOG_FILE, mode='a')
file_handler.setFormatter(formatter)
logger.addHandler(file_handler)

# Logging function to mirror bash 'log_event'
def log_event(message):
    logger.info(message)

# Example usage
log_event("Starting main configuration script")
```


